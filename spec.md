# AI 考试系统 - 系统规格说明书

## 1. 系统概览
**AI 考试系统** 是一个专为教育环境设计的轻量级、安全且现代化的在线考试平台。它为教师提供了创建和管理考试的完整工作流，同时也为学生提供了参加考试和查看成绩的便捷途径。该系统采用 **React** 前端和 **Supabase** 后端（BaaS）构建，确保了系统的可扩展性、实时能力和强大的安全性。

## 2. 技术架构

### 2.1 技术栈
- **前端**: React (Vite), 原生 CSS (使用现代 CSS 变量 & Flexbox/Grid 布局), React Router。
- **后端**: Supabase (PostgreSQL, Auth, Edge Functions/RPC)。
- **认证**: Supabase Auth (邮箱/密码)，支持基于角色的访问控制 (RBAC)。
- **数据库**: PostgreSQL，启用行级安全策略 (RLS)。
- **托管**: Netlify (前端)。

### 2.2 安全模型
- **行级安全 (RLS)**: 严格的策略确保用户只能访问与其角色和所有权相关的数据。
- **服务端评分**: 考试提交和评分逻辑封装在 PostgreSQL RPC 函数 (`grade_and_submit_exam`) 中，防止客户端答案泄露。
- **安全档案管理**: 修改密码时强制验证旧密码。

## 3. 核心模块与功能

### 3.1 认证与用户管理
- **注册与登录**: 支持角色选择（教师/学生）的安全邮箱/密码认证。
- **个人档案管理**:
    - 更新显示名称。
    - 上传/更新头像 (基于 URL)。
    - 安全修改密码 (需验证旧密码)。
    - 登录时自动填充上次使用的邮箱。
- **会话管理**: 持久化会话，支持安全登出。

### 3.2 教师模块
专为内容创作和绩效分析设计。
- **仪表盘**: 管理题目和考试的中心枢纽。
- **题目管理**:
    - **手动创建**: 提供丰富的界面，支持创建带有动态选项（2-5 个选项）的题目。
    - **批量导入**: 支持通过 CSV 或 JSON 文件批量导入题目。
    - **题库**: 所有已创建题目的列表视图，提供管理选项。
- **考试管理**:
    - **考试创建**: 通过从题库中选择题目、设置标题和时长来组卷。
    - **考试列表**: 查看和管理当前活动的考试。
- **分析与结果**:
    - **考试表现**: 查看每场考试的学生提交列表。
    - **详细统计**: 分析错误分布和题目层级的表现指标。

### 3.3 学生模块
专为流畅且无干扰的评估体验设计。
- **仪表盘**:
    - **可用考试**: 以卡片形式展示可参加的考试。
    - **近期成绩**: 快速访问过往考试记录。
- **考试界面**:
    - **无干扰 UI**: 界面简洁，聚焦于当前题目。
    - **计时器**: 实时倒计时。
    - **导航**: 便捷的题目切换导航。
    - **动态选项**: 支持可变数量的选项 (A-E)。
    - **安全提交**: 一键提交，触发服务端评分。
- **结果回顾**:
    - **即时反馈**: 完卷后立即显示分数。
    - **详细解析**: 逐题回顾考试情况，显示所选答案与正确答案的对比，并配有视觉指示（绿色/红色）。

### 3.4 UI/UX 与设计系统
- **设计语言**: 采用 "Slate & Indigo" 配色的现代简洁美学。
- **响应式设计**: 针对桌面端、平板和移动端（低至 iPhone SE 尺寸）进行了全面优化。
    - 自适应布局 (Grid 转 Stack)。
    - 触控友好的交互目标。
    - 使用 `clamp()` 实现响应式排版。
- **组件**:
    - **自定义模态框**: 可复用的模态框系统，用于确认和表单交互。
    - **Toast 通知**: 非侵入式的成功/错误反馈。
    - **加载状态**: 平滑的骨架屏和加载指示器，提升感知性能。
    - **动画**: 细腻的淡入和过渡效果，营造高级感。

## 4. 数据库架构摘要

### `profiles` (用户档案)
- 用户身份扩展表，存储 `role` (角色), `username` (用户名), `avatar_url` (头像链接)。

### `questions` (题目)
- 存储题目内容, `options` (选项 JSONB), `answer` (答案), `score` (分值), 以及创建者引用。

### `exams` (考试)
- 存储考试元数据 (`title` 标题, `duration` 时长, `total_score` 总分) 和 `question_ids` (题目 ID 列表 JSONB)。

### `exam_results` (考试结果)
- 存储学生提交记录，包括 `score` (分数), `answers` (答案 JSONB 映射), 和提交时间戳。

## 5. 未来规划 (潜在)
- **富文本/图片支持**: 允许在题目和选项中插入图片。
- **定时可用性**: 设置考试在特定时间段开启/关闭。
- **导出结果**: 将学生成绩导出为 CSV/Excel。
- **实时监考**: 基础的专注度追踪或切屏检测。
